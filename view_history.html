<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¬¸ì œ ìˆ˜ì • ì´ë ¥</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f5f5f5;
    }
    h2 {
      margin-top: 30px;
    }
  </style>
</head>
<body>

<h1>ğŸ•’ ë¬¸ì œ ìˆ˜ì • ì´ë ¥ ë³´ê¸°</h1>
<div>
  <label>ë¬¸ì œ ID: <input type="number" id="problemIdInput" /></label>
  <button onclick="loadHistory()">ì´ë ¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
</div>

<h2 id="historyTitle"></h2>

<table id="historyTable">
  <thead>
    <tr>
      <th>ìˆ˜ì •ì¼</th>
      <th>ì œëª©</th>
      <th>ì§ˆë¬¸</th>
      <th>ì •ë‹µ</th>
      <th>í•´ì„¤</th>
      <th>ë‚œì´ë„</th>
      <th>ìœ í˜•</th>
      <th>ë¹„êµ</th> <!-- âœ… ì¶”ê°€ -->
    </tr>
  </thead>
  <tbody></tbody>
</table>


<div id="diffResult" style="margin-top: 30px; padding: 15px; border: 1px solid #ccc; background-color: #f9f9f9; display: none;">
  <h3>ğŸ” ë³€ê²½ëœ í•„ë“œ</h3>
  <ul id="diffList"></ul>
</div>



<script>
function loadHistory() {
  const problemId = document.getElementById('problemIdInput').value;
  if (!problemId) {
    alert("ë¬¸ì œ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  fetch('get_history_by_id.php?id=' + problemId)
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector('#historyTable tbody');
      tbody.innerHTML = '';
      document.getElementById('historyTitle').textContent = `ğŸ“ ë¬¸ì œ ID ${problemId}ì˜ ìˆ˜ì • ì´ë ¥ (${data.data.length}ê°œ)`;

      if (!data.success || data.data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7">ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      data.data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.updated_at}</td>
          <td>${row.title}</td>
          <td>${row.question}</td>
          <td>${row.answer}</td>
          <td>${row.solution}</td>
          <td>${row.difficulty}</td>
          <td>${row.type}</td>
          <td><button onclick="compareHistory(${row.id})">ë¹„êµ</button></td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => {
      alert("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
      console.error(err);
    });
}
</script>
<script>
function compareHistory(historyId) {
  fetch('get_history_diff.php?history_id=' + historyId)
    .then(res => res.json())
    .then(data => {
      const diffBox = document.getElementById('diffResult');
      const list = document.getElementById('diffList');
      list.innerHTML = '';

      if (!data.success || data.diff.length === 0) {
        list.innerHTML = '<li>ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤. ë™ì¼í•œ ë‚´ìš©ì…ë‹ˆë‹¤.</li>';
      } else {
        data.diff.forEach(d => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${d.field}</strong><br>
            <span style="color: red;">ì´ì „:</span> ${d.old}<br>
            <span style="color: green;">í˜„ì¬:</span> ${d.new}<br><br>`;
          list.appendChild(li);
        });
      }
      diffBox.style.display = 'block';
      diffBox.scrollIntoView({ behavior: 'smooth' });
    })
    .catch(err => {
      alert('ë¹„êµ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err);
    });
}
</script>

</body>
</html>
