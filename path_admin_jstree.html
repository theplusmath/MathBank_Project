<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë”í”ŒëŸ¬ìŠ¤ìˆ˜í•™ ê²½ë¡œ ê´€ë¦¬</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jstree@3.3.12/dist/themes/default/style.min.css">
  <style>
    body {
      font-family: 'Malgun Gothic', sans-serif;
      padding: 20px;
    }
    #tree {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      background: #fdfdfd;
    }
    .jstree-anchor {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .jstree-anchor .actions {
      margin-left: auto;
      margin-right: 10px;
    }
    .actions button {
      margin-left: 5px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h2>ğŸ“ ë”í”ŒëŸ¬ìŠ¤ìˆ˜í•™ ê²½ë¡œ ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
  <div id="tree"></div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jstree@3.3.12/dist/jstree.min.js"></script>
  <script>
    $(function() {
      // ì´ˆê¸° ê²½ë¡œ íŠ¸ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°
      $('#tree').jstree({
        core: {
          check_callback: true,
          data: function (obj, cb) {
            $.getJSON('select_path.php', function(res) {
              const nodes = res.data.map(item => ({
                id: item.id,
                parent: item.parent_id ? item.parent_id : '#',
                text: item.name,
                data: item,
              }));
              cb(nodes);
            });
          }
        },
        plugins: ["dnd", "contextmenu", "state", "types"],
        contextmenu: {
          items: function(node) {
            return {
              rename: {
                label: "âœ ì´ë¦„ ìˆ˜ì •",
                action: function () {
                  $('#tree').jstree('edit', node);
                }
              },
              create: {
                label: "â• í•˜ìœ„ ê²½ë¡œ ì¶”ê°€",
                action: function () {
                  const name = prompt("í•˜ìœ„ ê²½ë¡œ ì´ë¦„ì€?");
                  if (!name) return;
                  $.post('insert_path.php', {
                    parent_id: node.id,
                    name: name,
                    depth: parseInt(node.data.depth) + 1
                  }, function(res) {
                    if (res.success) location.reload();
                    else alert('ë“±ë¡ ì‹¤íŒ¨');
                  }, 'json');
                }
              },
              remove: {
                label: "ğŸ—‘ ì‚­ì œ",
                action: function () {
                  if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
                  $.get('delete_path.php?id=' + node.id, function(res) {
                    if (res.success) location.reload();
                    else alert('ì‚­ì œ ì‹¤íŒ¨');
                  }, 'json');
                }
              }
            };
          }
        }
      }).on('rename_node.jstree', function(e, data) {
        $.post('update_path.php', {
          id: data.node.id,
          name: data.text
        }, function(res) {
          if (!res.success) alert('ìˆ˜ì • ì‹¤íŒ¨');
        }, 'json');
      }).on('move_node.jstree', function(e, data) {
        const parent = data.parent === '#' ? null : data.parent;
        const newOrder = $("#" + parent).children("ul").children("li").map(function() {
          return this.id;
        }).get();

        $.post('move_path.php', {
          ids: JSON.stringify(newOrder)
        }, function(res) {
          if (!res.success) alert('ì •ë ¬ ì €ì¥ ì‹¤íŒ¨');
        }, 'json');
      });
    });
  </script>
</body>
</html>
